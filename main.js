(()=>{"use strict";var e="https://nomoreparties.co/v1/plus-cohort-23",t="ff079546-db20-4fbb-8f18-2cc7ab32ac96";function n(n,o,r,c){return fetch("".concat(e,"/").concat(n),{method:o,headers:{authorization:"".concat(t),"Content-Type":"".concat(c)},body:r}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("failed fetch. Code error:".concat(e))}))}function o(){return n("cards","GET")}function r(){return n("users/me","GET")}var c=document.querySelector(".popup_type-edit-profile"),a=document.querySelectorAll(".popup__close-button"),u=document.querySelectorAll(".popup"),i=document.querySelector(".profile__add-card-button"),p=document.querySelector(".popup_type-new-place"),l=document.querySelector(".popup_type-change-avatar"),s=document.querySelector("#editProfileForm"),d=document.querySelector("#changeAvatarForm"),_=document.querySelector("#addCardForm"),m=document.querySelector(".popup_text-new-place-img-name"),v=document.querySelector(".popup_text-new-place-img-url"),f=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__avatar"),S=document.querySelector(".popup__input_text_person-name"),b=document.querySelector(".popup__input_text_new-avatar-url"),q=document.querySelector(".popup__input_text_description-of-person"),C=document.querySelector(".profile__name-text"),L=document.querySelector(".profile__description-text"),E=document.querySelector(".profile__avatar");function x(e){e.classList.add("popup_transition"),e.classList.remove("popup_opened"),document.removeEventListener("keydown",h)}function g(e){if(e.classList.add("popup_opened"),document.addEventListener("keydown",h),!Array.from(e.classList).includes("popup_type-big-image")){e.querySelector(".popup__submit-button").classList.add("popup__submit-button_inactive");var t=e.querySelector(".popup__input-error");t.textContent="",t.classList.remove("popup__input-error_active")}}function h(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function k(e){var t=e.querySelector(".popup__submit-button");t.classList.add("popup__submit-button_inactive"),t.disabled=!0,t.value="Disabled";var n=e.querySelector(".popup__input-error");n.textContent="",n.classList.remove("popup__input-error_active")}s.addEventListener("submit",(function(e){e.preventDefault(),function(e){e.textContent="Сохранение...";var t,o=S.value,a=q.value;(t={newName:"".concat(o),newAbout:"".concat(a),contentType:"application/json"},n("users/me","PATCH",JSON.stringify({name:"".concat(t.newName),about:"".concat(t.newAbout)}),t.contentType)).then((function(){r().then((function(e){C.textContent=e.name,L.textContent=e.about})),e.textContent="Сохранить",x(c)}))}(s.querySelector(".popup__submit-button")),e.target.reset()})),d.addEventListener("submit",(function(e){e.preventDefault();var t=d.querySelector(".popup__submit-button");t.textContent="Сохранение...";var o,c=b.value;(o={newUrl:"".concat(c),contentType:"application/json"},n("users/me/avatar","PATCH",JSON.stringify({avatar:"".concat(o.newUrl)}),o.contentType)).then((function(){r().then((function(e){E.src=e.avatar,x(l),t.textContent="Сохранить",b.value=""}))}))})),_.addEventListener("submit",(function(e){e.preventDefault();var t=_.querySelector(".popup__submit-button");t.textContent="Сохранение...";var r,c=m.value,a=v.value;(r={name:"".concat(c),link:"".concat(a),contentType:"application/json"},n("cards","POST",JSON.stringify({name:"".concat(r.name),link:"".concat(r.link)}),r.contentType)).then((function(){o().then((function(e){var t=e[0];N(t.name,t.link,t.likes,t.owner.name,t._id)})),x(p),t.textContent="Сохранить"})),e.target.reset()})),a.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return x(t)}))})),u.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&x(e)}))})),i.addEventListener("click",(function(){g(p),k(p)})),f.addEventListener("click",(function(){g(c),S.value=C.textContent,q.value=L.textContent,k(c)})),y.addEventListener("click",(function(){g(l)}));var T=document.querySelector(".places-grid"),w=document.querySelector(".popup_type-big-image"),A=document.querySelector(".popup__main-photo"),D=document.querySelector(".popup_text-big-image");function N(e,t){var o=document.querySelector("#card-template").content.querySelector(".place-card").cloneNode(!0);o.querySelector(".place-card__desctiption-text").textContent=e,o.querySelector(".place-card__image").src=t,o.querySelector(".place-card__image").alt="".concat(e,"-photo");var r=o.querySelector(".place-card__trash-button");o.id=id;var c=likes.length;o.querySelector(".place-card__like-number").textContent=c,o.querySelector(".place-card__like-button").addEventListener("click",(function(e){e.target.classList.contains("place-card__like-button_active")?(function(e){n("cards/likes/".concat(e),"DELETE")}(id),e.target.classList.remove("place-card__like-button_active"),o.querySelector(".place-card__like-number").textContent=c):(function(e){n("cards/likes/".concat(e),"PUT")}(id),e.target.classList.add("place-card__like-button_active"),o.querySelector(".place-card__like-number").textContent=c+1)})),r.addEventListener("click",(function(e){var t=e.target.closest(".place-card");!function(e){n("cards/".concat(e),"DELETE")}(t.id),t.remove()})),o.querySelector(".place-card__image").addEventListener("click",(function(e){var t=e.target.src;g(w),A.src=t,D.textContent=o.querySelector(".place-card__desctiption-text").textContent,A.alt="".concat(D.textContent,"-big-photo")})),function(e){T.prepend(e)}(o)}var P,j=function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)},B=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1,t.value="Enabled"):(t.classList.add(n.inactiveButtonClass),t.disabled=!0,t.value="Disabled")},F=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);B(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){/[^а-яa-z\_\-\s\ё]/gi.test(t.value)&&"url"!==t.type?(t.setCustomValidity("оба поля могут содержать только латинские буквы, кириллические буквы, знаки дефиса и пробелы"),j(e,t,t.validationMessage,n)):!1===t.validity.valid?(t.setCustomValidity(""),j(e,t,t.validationMessage,n)):(function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n),t.setCustomValidity(""))}(e,r,t),B(n,o,t)}))}))};r().then((function(e){C.textContent=e.name,L.textContent=e.about,E.src=e.avatar})),o().then((function(e){e.reverse().forEach((function(e){N(e.name,e.link,e.likes,e.owner.name,e._id)}))})),P={inputErrorClass:"popup__input_type_error",popupFormSelector:".popup__profile-form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",errorClass:"popup__input-error_active",inactiveButtonClass:"popup__submit-button_inactive"},Array.from(document.querySelectorAll(P.popupFormSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(P.formSet)).forEach((function(e){F(e,P)})),F(e,P)}))})();